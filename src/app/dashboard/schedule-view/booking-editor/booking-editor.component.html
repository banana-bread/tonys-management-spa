<form #form="ngForm" (ngSubmit)="onSave()">
<h1 mat-dialog-title>{{ this.booking?.id ? '' : 'New' }} Booking</h1>
<div mat-dialog-content>
    <div fxLayout="column" *ngIf="!loading">
        <div fxFlex fxLayout="column" *ngIf="!booking?.id">
            <mat-form-field fxFlex>
                <mat-label>Start Time</mat-label>
                <mat-select name="startTime"
                    #startTimeField="ngModel"
                    [(ngModel)]="startTime"
                    [disabled]="saving" 
                    [errorStateMatcher]="errorStateMatcher"
                    required>
                    <mat-option *ngFor="let time of times()" [value]="time">
                        {{ time | appTimeOfDay:event.start}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="startTimeField.hasError('required')">Start time is required.</mat-error>
                <mat-error *ngIf="startTimeField.hasError('overlap')">Start time unavailable for the selected services.</mat-error>
            </mat-form-field>
            <mat-form-field fxFlex>  
                <mat-label>Service</mat-label>
                <mat-select name="servicesField" 
                    #servicesField="ngModel"
                    [(ngModel)]="selectedServices"
                    (ngModelChange)="onServicesChanged()"
                    [disabled]="saving"
                    multiple 
                    required>
                    <mat-option *ngFor="let service of services" [value]="service">
                        {{ service.name }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="servicesField.hasError('required')">At least one service is required.</mat-error>
            </mat-form-field>
        </div>
        <div fxLayout="column" fxLayoutGap="8px">
            <div fxLayout="row" fxLayoutAlign=" center" fxLayoutGap="8px">
                <span class="material-icons-outlined">perm_identity</span>
                <span>{{ employee.first_name }}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign=" center" fxLayoutGap="8px">
                <span class="material-icons-outlined">schedule</span>
                <span>{{ event.start | date:'EEEE, MMMM d' }}, {{ formatTime(startTime) | date:'h:mm a' }} - </span>
                <span *ngIf="!!this.booking">{{ formatTime(endTime) | date:'h:mm a' }}</span>
                <span *ngIf="!this.booking && this.selectedServices.length">{{ formatTime(endTime) | date:'h:mm a' }}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign=" center" fxLayoutGap="8px" *ngIf="booking?.id">
                <span class="material-icons-outlined">build</span>
                <span>
                    {{ this.displayServices() }}
                </span>
            </div>
        </div>
    </div>
    <div fxLayout="row" *ngIf="loading" fxLayoutAlign="center">
        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
</div>
<div mat-dialog-actions align="end">
    <button class="icon-button" type="button" mat-icon-button [disabled]="loading" *ngIf="booking?.id" (click)="onCancelBooking()"><mat-icon>delete</mat-icon></button>
    
    <span fxFlex></span>

    <mat-progress-spinner mode="indeterminate" diameter="36" *ngIf="saving"></mat-progress-spinner>
    <button type="button" mat-flat-button mat-dialog-close>Cancel</button>
    <button type="submit" mat-flat-button color="accent" [disabled]="saving || loading || booking?.id">Save</button>
    <!-- <button type="button" mat-raised-button mat-dialog-close [disabled]="saving || loading" *ngIf="booking?.id">Ok</button> -->
</div>
</form>